
---
title: "Output"
author: 
  - Pascal Lee Slew
  - Yunkyung Park
date: "`r format(Sys.time(), '%d %B %Y')`"
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
output:
  bookdown::pdf_document2
toc: FALSE
#bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r library, echo=FALSE, message=FALSE}
# install.packages('bookdown')
library(dplyr)
library(tidyverse) 
library(janitor)
library(ggplot2)
library(knitr)
library(kableExtra)
library(bookdown)
```

```{r read_data, echo=FALSE, message=FALSE, warning=FALSE}
gss<- read_csv('data1.csv', show_col_types = FALSE)
raw_data <- read_csv('gssv.csv')
```

# I. Introduction

This dataset contains core and 

```{r age, echo=FALSE, fig.cap='Distribution of age-groups and gender in the 2018 GSS survey'}
age <-
  gss %>%
  mutate(age_group = 
           case_when(age == "15 to 24 years" ~ "15-24",
                     age == "25 to 34 years" ~ "25-34",
                     age == "35 to 44 years" ~ "35-44",
                     age == "45 to 54 years" ~ "45-54",
                     age == "55 to 64 years" ~ "55-64",
                     age == "65 to 74 years" ~ "65-74",
                     age == "75 years and over" ~ ">=75"
                     ),
         age_group = factor(age_group,
                            levels = c("15-24",
                                       "25-34",
                                       "35-44",
                                       "45-54",
                                       "55-64",
                                       "65-74",
                                       ">=75"
                                       )
                            )
         )
age %>%
  ggplot(mapping=aes(x=age_group, fill=gender)) +
  geom_bar(position = "dodge") +
  theme_minimal() +
  labs(x='Age-group of respondent', y='Number of respondents', 
       title='Distribution of age-groups and gender in the 2018 GSS survey',
       fill='Gender')
```

The age distribution of survey respondents is shown in Figure \@ref(fig:age). Among the selected household, one member was chosen to represent the household. Figure \@ref(fig:age) shows that it was more likely that the female in their middle ages were selected to complete the questionnaire.

```{r maritalstatus, echo=FALSE, fig.cap='Marital Status'}
income <-
  gss %>%
  mutate(fam_income_quintile = 
           case_when(fam_income_quintile == "Highest quintile" ~ "Highest",
                     fam_income_quintile == "Second quintile" ~ "Second",
                     fam_income_quintile == "Third quintile" ~ "Third",
                     fam_income_quintile == "Fourth quintile" ~ "Fourth",
                     fam_income_quintile == "Lowest quintile" ~ "Lowest",
                     ),
         fam_income_quintile = factor(fam_income_quintile,
                                      levels = c('Highest',
                                                 'Second',
                                                 'Third',
                                                 'Fourth',
                                                 'Lowest')
         )
  )

income %>%
  ggplot(mapping=aes(x=marital_status))+
  geom_bar() + 
  theme_minimal() +
  labs(x='', title='Marital Status') +
  theme(axis.text.x = element_text(angle=15))
```

```{r maritalandincome, echo=FALSE, fig.cap='Marital Status and Family Income Quintile'}

income %>%
  ggplot(mapping=aes(x=fam_income_quintile, fill=fam_income_quintile)) +
  geom_bar() +
  theme_minimal() +
  labs(x='', title='Marital Status') +
  theme(axis.text.x = element_text(angle=15), legend.position='none') +
  facet_wrap(vars(marital_status),
             dir = "v",
             scales = "free")
```

Marital status is important in tracking the evolution of social attitudes. The combination of the marital status and family income can be used to indicate the socio-economic status of various types of families. Figure \@ref(fig:maritalstatus) indicates that the most common family structure in Canada is married couples. Figure \@ref(fig:maritalandincome) tells that the distribution of the family income quintile is similar between the married couples and the common-law couples, and it is similar among the rest.

### Awareness

```{r awareness, echo=FALSE, fig.cap="Awareness of the charity organizations"}
dg <- gss %>% 
  select(starts_with('decision_on_giving_'))

dg_awareness<-
  dg %>%
    select(decision_on_giving_know_how_to_verify, decision_on_giving_org_monitoring)

awareness_lst<-c('Know how to verify whether an organization is a registered charity',
                 'Monitor how charities in Canada use their donations')

df_awareness<-data.frame('Items'=c(''),
                         'No'=c(''),
                         'Yes'=c(''),
                         'NA'=c(''))
i <- 1
for (r in colnames(dg_awareness)){
  counted<-
    dg_awareness %>%
    count(.data[[r]]) %>%
    mutate(proportion = round(n/sum(n),4)*100)
  
  df_awareness<-rbind(df_awareness, c(awareness_lst[i], counted$proportion))
  i<-i+1
}

df_awareness<-df_awareness[-c(1),]

df_awareness %>% 
  as_tibble() %>%
  relocate(Yes, .after=Items) %>%
  relocate(No, .after=Yes) %>%
  kable(caption = "Awareness of the charity organizations", format="latex") %>%
  row_spec(0, bold=TRUE) %>%
  kable_styling()
```

Based on Table \@ref(tab:awareness), we can first observe that most people do not know how to check if a charity is registered in Canada. A "registered charity" refers to a charitable organization that is registered with the Canada Revenue Agency (@CRA). The donation made to the registered charity is exempted from paying income tax, and the charity can issue tax receipts for donations it receives (@CRA). Next, most charities openly share their information on how the donations are being used for its accountability and transparency (@charity). However, we can tell that people do not monitor how charities use their donations. 

### How to decide where to donate 

```{r dgsearch, echo=FALSE, fig.cap='Do people search before making a donation?'}
# https://statisticsglobe.com/wrap-long-axis-labels-ggplot2-plot-into-multiple-lines-r
dg <-
  dg %>% 
  mutate(decision_on_giving_search =
           recode(
             decision_on_giving_search,
             'Yes'='Yes',
             'No'='No',
             'Sometimes'='Yes',
             'NA'='Never considered donating',
             'You never consider donating to a charity that you have no...' = 'Never considered donating'))

dg %>%
  ggplot(aes(x=decision_on_giving_search, fill=decision_on_giving_search)) +
  geom_bar() +
  theme_minimal() +
  theme(legend.position='none') +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10))
```

```{r search, echo=FALSE, fig.cap='What method do people use in searching a new charity?'}
dg_search_detail <-
  dg %>%
  filter(decision_on_giving_search=="Yes" | decision_on_giving_search=="Sometimes") %>%
  select(starts_with('decision_on_giving_search'))

dg_search_detail <-
  dg_search_detail %>%
  select(-decision_on_giving_search,
         -decision_on_giving_search_consult_other_source)

dg_search_df<-data.frame('Method'=c(''),
                         'No'=c(''),
                         'Yes'=c(''),
                         'NA'=c(''))

dg_search_lst<-c('Read information provided by the charity',
                 'Contact the charity directly',
                 'Consult the CRA website',
                 'Consult the website of a non-profit or private organization',
                 'A general online search',
                 'Ask someone',
                 'Other'
)

i <- 1
for (r in colnames(dg_search_detail)){
  counted<-
    dg_search_detail %>%
    count(.data[[r]]) %>%
    mutate(proportion = round(n/sum(n),4)*100)
  
  dg_search_df<-rbind(dg_search_df, c(dg_search_lst[i], counted$proportion))
  i<-i+1
}

dg_search_df<-dg_search_df[-c(1),]

dg_search_df %>% 
  as_tibble() %>%
  mutate(Yes = as.numeric(Yes),
         No = as.numeric(No),
         NA. = as.numeric(NA.)) %>%
  arrange(desc(Yes)) %>%
  relocate(Yes, .after=Method) %>%
  kable(caption = "Decision On Giving search") %>%
  row_spec(0, bold=TRUE) %>%
  kable_styling()
```

Next, we observed whether people do a research on the organizations before making donations, and if they do, what methods are being used to search for the charity. Figure \@ref(fig:dgsearch) shows that most people have not considered making donations, but if they have, then they usually search for information on the charity before giving.

Among those who search before they donate to a charity, Figure \@ref(fig:search) shows that people are mostly likely to read information provided by the charity and do a general online search. It should be noted that even though the list of the registered charitities can be viewed from the CRA website, people did not consider consulting the CRA website before making donations. 

### Reasons for giving

```{r reasonsforgiving, echo=FALSE, fig.cap='Reasons for giving'}
# choose the data who has donated in the past 12 months
reasons_for_giving <-
  gss %>%
    select(reas_giv_pers_affected,
           reas_giv_tax_cred,
           reas_giv_religious,
           reas_giv_spiritual_beliefs,
           reas_giv_cause,
           reas_giv_compassion,
           reas_giv_community_contribution,
           reas_giv_being_asked)
  # filter(reas_giv_pers_affected != "NA")

rg_lst<-c('Personally affected',
          'Tax Credit',
          'Religious',
          'Spiritual beliefs',
          'Cause',
          'Compassion',
          'Community contribution',
          'Being asked')

rg<-data.frame('Reason'=c(''),
               'NA'=c(''),
               'No'=c(''),
               'Yes'=c(''))

i <- 1
for (r in colnames(reasons_for_giving)){
  counted<-
    reasons_for_giving %>%
    count(.data[[r]]) %>%
    mutate(proportion = round(n/sum(n),4)*100)
  rg<-rbind(rg, c(rg_lst[i], counted$proportion))
  i<-i+1
}
rg<-rg[-c(1),]

rg %>% 
  as_tibble() %>%
  mutate(Yes = as.numeric(Yes),
         No = as.numeric(No),
         NA. = as.numeric(NA.)) %>%
  arrange(desc(Yes)) %>%
  relocate(Yes, .after=Reason) %>%
  relocate(No, .after=Yes) %>%
  kable(caption = "Reasons for giving") %>%
  row_spec(0, bold=TRUE) %>%
  kable_styling()
```

We observed the reasons for giving. Note that only the respondents who have made the donations in the past 12 months have answered this questionnaire. Figure \@ref(fig:reasonsforgiving) indicates that it varies for each people why they decide to make donations. There is no general reason that specifies the reason people give money to the charity. 

### Reasons for not giving (more)

```{r reasonsfornotgiving, echo=FALSE, fig.cap='Reasons for not giving (more)'}
reasons_for_not_giving <-
  gss %>%
    select(starts_with("reas_not_giv"),
           -reas_not_giv_not_efficient_fundrais,
           -reas_not_giv_not_efficient_impact,
           -reas_not_giv_not_efficient_explanation,
           -reas_not_giv_not_efficient_other,
           -reas_not_giv_request_time_of_day,
           -reas_not_giv_request_num,
           -reas_not_giv_request_tone,
           -reas_not_giv_request_multiple,
           -reas_not_giv_request_method,
           -reas_not_giv_request_other) %>%
  mutate(reas_not_giv_charity_fraud = 
           case_when(reas_not_giv_charity_fraud == "Agree" ~ "Yes",
                     reas_not_giv_charity_fraud == "Disagree" ~ "No",
                     reas_not_giv_charity_fraud == "NA" ~ "NA"),
         reas_not_giv_so_many_org = 
           case_when(reas_not_giv_so_many_org == "Agree" ~ "Yes",
                     reas_not_giv_so_many_org == "Disagree" ~ "No",
                     reas_not_giv_so_many_org == "NA" ~ "NA"))

ng_lst<-c('Already gave',
          'Cannot afford',
          'Not being asked',
          'Did not know where to donate',
          'Hard to find cause',
          'Volunteered instead',
          'Gave directly to people',
          'Tax credit not incentive enough',
          'Money would not be used efficient',
          'Did not like the way requested',
          'So many organizations',
          'Charity fraud'
          )

ng<-data.frame('Reason'=c(''),
               'NA'=c(''),
               'No'=c(''),
               'Yes'=c(''))

i <- 1
for (r in colnames(reasons_for_not_giving)){
  counted<-
    reasons_for_not_giving %>%
    count(.data[[r]]) %>%
    mutate(proportion = round(n/sum(n),4)*100)
  ng<-rbind(ng, c(ng_lst[i], counted$proportion))
  i<-i+1
}
ng<-ng[-c(1),]

ng %>% 
  as_tibble() %>%
  mutate(Yes = as.numeric(Yes),
         No = as.numeric(No),
         NA. = as.numeric(NA.)) %>%
  arrange(desc(Yes)) %>%
  relocate(Yes, .after=Reason) %>%
  relocate(No, .after=Yes) %>%
  kable(caption = "Reasons for not giving") %>%
  row_spec(0, bold=TRUE) %>%
  kable_styling()
```

Next, we observed for the reasons for not giving. If the respondents have made the donations in the past 12 months, then it asked for the reasons why they did not donate more, which can be observed from Figure \@ref(fig:reasonsfornotgiving) that 31.17% of the respondents have donated in the past 12 months. When the respondents have not made the donations, then it asked for the reasons for not giving. Figure \@ref(fig:reasonsfornotgiving) shows that 42.57% of the respondents decided to volunteer instead of giving. Also, 42.41% of the respondents answered that they did not like the way they were being requested. Additionally, it is worth mentioning that although there are so many organizations, that was not the main reason why people decided not to give money. It was that they did not know where to make donations among the organizations, and they were afraid that money would not be used efficient. Furthermore, 42.32% of the respondents said that they gave money directly to people who were in need of financial assistance.  

### Other givings

```{r othergiving, echo=FALSE}
other_giving<-
  gss %>%
  select(starts_with("other_giv_"))

og_lst<-c('Food',
          'Clothings, toys, or household goods',
          'Other',
          'Directly to people'
          )

og<-data.frame('Other'=c(''),
               'NA'=c(''),
               'No'=c(''),
               'Yes'=c(''))

i <- 1
for (r in colnames(other_giving)){
  counted<-
    other_giving %>%
    count(.data[[r]]) %>%
    mutate(proportion = round(n/sum(n),4)*100)
  og<-rbind(og, c(og_lst[i], counted$proportion))
  i<-i+1
}
og<-og[-c(1),]

og %>% 
  as_tibble() %>%
  mutate(Yes = as.numeric(Yes),
         No = as.numeric(No),
         NA. = as.numeric(NA.)) %>%
  relocate(Yes, .after=Other) %>%
  relocate(No, .after=Yes) %>%
  kable(caption = "Other givings") %>%
  row_spec(0, bold=TRUE) %>%
  kable_styling()
```

Lastly, we observed the other givings they have made besides financial donations to the charity. 7% of the respondents have donated food to the organizations such as food bank, and 6.72% donated clothings, toys, or household goods. In addition, 6.64% have made other givings directly to the ones who were in need of help. 6.90% made a donation to a charity in their will or through another financial planning product such as insurance.

```{r donationresponse, fig.cap = "Donations made by responding to methods", echo = FALSE}
# Graph showing the counts for y/n for financial giving

# select the required variables
# rename the variables
financial_giving <- gss %>% 
  select(starts_with("fin_giving_"), caseid) %>% 
  rename("mail" = "fin_giving_mail",
         "telephone" = "fin_giving_telephone",
         "tv" = "fin_giving_tv",
         "online" = "fin_giving_online",
         "own initiative" = "fin_giving_own_initiative",
         "charity event" = "fin_giving_charity_event",
         "in mem of someone" = "fin_giving_in_mem_of_someone",
         "work" = "fin_giving_work",
         "door to door canvassing" = "fin_giving_door_to_door_canvassing",
         "shopping centre" = "fin_giving_shopping_centre",
         "place of worship" = "fin_giving_place_of_worship",
         "sponsoring" = "fin_giving_sponsoring",
         "other" = "fin_giving_other")

# tidy data
financial_giving <- financial_giving %>% 
  pivot_longer(!caseid,
               names_to = "name",
               values_to = "response")

# plot data
graph_1 <-
  financial_giving %>% 
  ggplot(aes(x = name, fill = response)) +
  geom_bar(position = "dodge") +
  labs(x = "Methods responded to",
       y = "Number of survey respondents") +
  coord_flip() +
  theme_minimal() +
  scale_fill_brewer(palette = "PuBu")

graph_1 + theme(legend.position = "bottom")
```


```{r numberdonations, echo = FALSE}
# total number of financial donations
# obtain the total number of financial donations from the raw dataset
total_number_fin_donation <- raw_data %>% 
  select(gs1dntot)

# rename column with a more appropriate name
clean_total_fin_donation <- total_number_fin_donation %>% 
  rename(number_of_financial_donations = gs1dntot)

# obtain the data for those who did not skip the question
clean_total_fin_donation_1 <- 
  clean_total_fin_donation %>% 
  filter(number_of_financial_donations != 96)

# number of people who skipped this question
skipped_response <-
  clean_total_fin_donation %>% 
  filter(number_of_financial_donations == '96') %>% 
  count()

# distribution of total number of financial donations made in the past 12 months
clean_total_fin_donation_1 %>% 
  ggplot(aes(x = number_of_financial_donations)) +
  geom_histogram(bins = 40, fill = "lightblue") +
  labs(x = "Total number of financial donations",
       y = "Number of donations") +
  theme_minimal()
```

```{r}
# investigate the total number of donations made through different means

```



```{r totalamount, echo = FALSE}
# total amount of donations
total_amount <- gss %>% 
  select(totl_amount_don12) %>% 
  rename(total = totl_amount_don12)

# data for only those who responded
total_amount_1 <- total_amount %>% 
  filter(total != 999999999.96)

# number of valid skipped responses
valid_skip_responses <- total_amount %>% 
  filter(total == 999999999.96) %>% 
  count()

# distribution of total amount of donations
total_amount_1 %>% 
  ggplot(aes(x = total)) +
  geom_histogram(bins = 30, fill = "lightblue") +
  labs(x = "Total amount of donations",
       y = "Number of donations") +
  theme_minimal()

```

```{r income, echo = FALSE}
# obtain income data
# rename the variables name
income_group <- raw_data %>% 
  select(incg2, famincg2) %>% 
  rename(personal_income_group = incg2,
         family_income_group = famincg2)

# recode the variable values
income_group <- income_group %>% 
  mutate(personal_income_group = 
           recode(personal_income_group,
                  "1" = "less than 25000",
                  "2" = "25000 to 49999",
                  "3" = "50000 to 74999",
                  "4" = "75000 to 99999",
                  "5" = "10000 to 124999",
                  "6" = "125000 or more"),
         family_income_group = recode(
           family_income_group,
                  "1" = "less than 25000",
                  "2" = "25000 to 49999",
                  "3" = "50000 to 74999",
                  "4" = "75000 to 99999",
                  "5" = "10000 to 124999",
                  "6" = "125000 or more")
           )

# distribution of income
income_group %>% 
  ggplot(aes(x = personal_income_group)) +
  geom_bar(fill = "lightblue") +
  labs(x = "Personal Income group before taxes",
       y = "Number of respondents") +
  theme_minimal() +
  coord_flip()

income_group %>% 
  ggplot(aes(x = family_income_group)) +
  geom_bar(fill = "orange") +
  labs(x = "Family Income group before taxes",
       y = "Number of respondents") +
  theme_minimal() +
  coord_flip()
```


# extra questionnaires
- How much do you donate proportional to your income? (I donate 10% of my income every year, etc.)
